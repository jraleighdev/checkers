let e;var t;let i;var o;let s;var r;let n;var a;let l;var h;let c;var p;let u;var v;function g(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}(t=e||(e={})).none="none",t.hover="hover",t.valid="valid",t.invalid="invalid",t.hasPiece="hasPiece",t.removePiece="removePiece",t.possibleMove="possible",(o=i||(i={})).dark="black",o.light="white",(r=s||(s={})).dark="brown",r.light="tan",r.hover="green",r.selectedValid="orange",r.selectedInvalid="red",r.possibleMove="yellow",(a=n||(n={}))[a.move=0]="move",a[a.jump=1]="jump",a[a.none=2]="none",(h=l||(l={}))[h.Positive=1]="Positive",h[h.Negative=-1]="Negative",(p=c||(c={})).g1="g1",p.g2="g2",p.g3="g3",p.g4="g4",(v=u||(u={}))[v.unkown=0]="unkown",v[v.light=1]="light",v[v.dark=2]="dark";class f{constructor(e,t,o,s,r){this.type=e,this.point=t,this.squareSize=o,this.radius=s,this.context=r,g(this,"isKing",!1),g(this,"color",void 0),this.color=e==u.dark?i.dark:i.light}draw(){this.context.beginPath();const e=0===this.point.x?this.squareSize/2:this.squareSize*this.point.x+this.squareSize/2,t=0===this.point.y?this.squareSize/2:this.squareSize*this.point.y+this.squareSize/2;this.context.arc(e,t,this.radius,0,2*Math.PI),this.context.fillStyle=this.color,this.context.fill(),this.isKing&&(this.context.font="40px arial",this.context.fillStyle=this.color==i.dark?i.light:i.dark,this.context.fillText("K",e-12,t+14))}move(e){this.point=e}isMatch(e){return this.point.x==e.x&&this.point.y==e.y}get isDark(){return this.type==u.dark}get isLight(){return this.type==u.light}}let d;var m;function y(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var o=i.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}g(f,"darkPieceColor","black"),g(f,"lightPieceColor","white"),(m=d||(d={}))[m.dark=1]="dark",m[m.light=2]="light";class P{constructor(e,t,i){this.type=e,this.path=t,this.point=i,y(this,"initialColor",void 0),y(this,"color",void 0),y(this,"hasPiece",!1),y(this,"isSelected",!1),y(this,"mouserIsOver",!1),y(this,"pieceType",u.unkown),this.color=e==d.dark?s.dark:s.light,this.initialColor=this.color}isMatch(e){return this.point.x==e.x&&this.point.y==e.y}applyAction(t){switch(t){case e.none:this.color=this.initialColor,this.isSelected=!1,this.mouserIsOver=!1;break;case e.hover:this.color=s.hover,this.mouserIsOver=!0;break;case e.invalid:this.color=s.selectedInvalid,this.isSelected=!0,this.mouserIsOver=!1;break;case e.valid:this.color=s.selectedValid,this.isSelected=!0,this.mouserIsOver=!1;break;case e.hasPiece:this.hasPiece=!0;break;case e.removePiece:this.hasPiece=!1,this.pieceType=u.unkown;break;case e.possibleMove:this.color=s.possibleMove}}}const k=document.getElementById("canvas"),b=k.getContext("2d"),x=[[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0]];let w,q,S=u.light,N=[];const M=[],j=[],A=(()=>{const t=[];for(let i=0;i<=x.length-1;i++){const o=x[i],r=[];for(let t=0;t<=o.length-1;t++){const n=o[t],a=new P(n,new Path2D,{x:t,y:i});if(a.path.rect(60*t,60*i,60,60),b.fillStyle=n===d.dark?s.dark:s.light,b.fill(a.path),r.push(a),n===d.dark){if(i<=2){const o=new f(u.dark,{x:t,y:i},60,20,b);o.draw(),j.push(o),a.applyAction(e.hasPiece)}if(i>=5){const o=new f(u.light,{x:t,y:i},60,20,b);o.draw(),M.push(o),a.applyAction(e.hasPiece)}}}t.push(r)}return t})(),E=(()=>{const e=[];for(let t=0;t<=x.length-1;t++){const i=A[t];for(let t=0;t<=i.length-1;t++)e.push(i[t])}return e})(),I=e=>[...M,...j].find((t=>t.isMatch(e))),O=e=>E.find((t=>t.isMatch(e))),z=e=>{if(e)return I(e.point)},K=()=>{(()=>{for(let e=0;e<=A.length-1;e++){const t=A[e];for(let i=0;i<=t.length-1;i++){const o=t[i];b.fillStyle=o.color,o.path.rect(60*i,60*e,60,60),b.fill(o.path)}}})(),M.forEach((e=>e.draw())),j.forEach((e=>e.draw()))},C=(e,t,i,o)=>{const s=[];for(let r=1;r<=2;r++){const a=e.x+t*r,l=e.y+i*r,h=O({x:a,y:l});h&&(h.hasPiece&&0==s.length?s.push({square:h,move:n.none,group:o}):!h.hasPiece&&s.length>0&&(s[r-s.length-1].move=n.jump,s.push({square:h,move:n.move,group:o})))}return s},L=(e,t,i,o)=>{let s=[];for(let r=1;r<=2&&!(s.length>0&&s.some((e=>e.move==n.move)));r++){if(2==s.length&&s.every((e=>e.move==n.none))){s=[];break}const a=e.x+t*r,h=e.y+i*r,c=O({x:a,y:h});if(c)if(0!=s.length||c.hasPiece)if(c.hasPiece)s.push({square:c,move:n.none,group:o});else{const t=s[r-s.length-1],a=I(e);if(z(t.square)?.type==a?.type)s.push({square:c,move:n.none,group:o});else{s[r-s.length-1].move=n.jump;const e={square:c,move:n.move,group:o};s.push(e);const t=[];a?.isKing?(t.push(...C(c.point,l.Positive,l.Positive,o)),t.push(...C(c.point,l.Negative,l.Positive,o)),t.push(...C(c.point,l.Positive,l.Negative,o)),t.push(...C(c.point,l.Negative,l.Negative,o))):(t.push(...C(c.point,l.Positive,i,o)),t.push(...C(c.point,l.Negative,i,o))),t.length>0&&s.push(...t)}}else c.hasPiece?s.push({square:c,move:n.none,group:o}):s.push({square:c,move:n.move,group:o})}return s},T=t=>{if(!t)return[];const i=[],o=t.point;return t.isKing?(i.push(...L(o,l.Positive,l.Positive,c.g1)),i.push(...L(o,l.Negative,l.Positive,c.g2)),i.push(...L(o,l.Positive,l.Negative,c.g3)),i.push(...L(o,l.Negative,l.Negative,c.g4))):t.isDark?(i.push(...L(o,l.Positive,l.Positive,c.g1)),i.push(...L(o,l.Negative,l.Positive,c.g2))):t.isLight&&(i.push(...L(o,l.Positive,l.Negative,c.g1)),i.push(...L(o,l.Negative,l.Negative,c.g1))),i.forEach((t=>{t.move==n.move&&(console.log(`possible move: ${t.square.point.x} ${t.square.point.y}`),t.square.applyAction(e.possibleMove))})),K(),i},D=(t,i)=>{if(!t)return;if(!q)return;const o=N.find((e=>e.square.isMatch(i.point)))?.group;if(o){const t=N.filter((e=>e.group==o)),i=t.filter((e=>e.move==n.jump));if(i&&i.length>0){const o=t.filter((e=>e.move==n.jump)).map((e=>z(e.square)));o&&o.length>0&&(o.forEach((e=>{if(e?.isDark){const t=j.indexOf(e);j.splice(t,1)}else if(e?.isLight){const t=M.indexOf(e);M.splice(t,1)}})),i.forEach((t=>t.square.applyAction(e.removePiece))))}}(e=>{if(e)return E.find((t=>t.isMatch(e.point)))})(t)?.applyAction(e.removePiece),i.applyAction(e.hasPiece),t.move(i.point),(e=>{if(e&&e.isKing)return;const t=e.type==u.dark?x.length-1:0;e.point.y==t&&(e.isKing=!0)})(t),K(),S=S==u.dark?u.light:u.dark};k.addEventListener("mousemove",(t=>{let i;w&&!w.isSelected&&w.applyAction(e.none);let o=!1;for(let s=0;s<=A.length-1&&!o;s++){const r=A[s];for(let s=0;s<=r.length-1;s++)if(i=r[s],b.isPointInPath(i.path,t.offsetX,t.offsetY)&&z(i)){i.isSelected||i.applyAction(e.hover),K(),o=!0,w=i;break}}})),k.addEventListener("click",(t=>{let i,o=!1;for(let s=0;s<=A.length-1&&!o;s++){const r=A[s];for(let s=0;s<=r.length-1;s++)if(i=r[s],b.isPointInPath(i.path,t.offsetX,t.offsetY)){console.log(`selected square: ${i.point.x} ${i.point.y}`),E.forEach((t=>t.applyAction(e.none)));const t=z(i);if(q){if(t)q=i,q.applyAction(t.type==S?e.valid:e.invalid),K(),t.type==S&&(N=T(t));else if(N.length>0&&N.some((e=>e.square.isMatch(i.point)))){const e=z(q);e&&D(e,i)}}else t&&(q=i,q.applyAction(t?.type==S?e.valid:e.invalid),K(),t.type==S&&(N=T(t)));o=!0;break}}}));